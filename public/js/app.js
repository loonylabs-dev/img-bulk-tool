var E=Object.defineProperty,I=(l,e,t)=>e in l?E(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t,r=(l,e,t)=>I(l,typeof e!="symbol"?e+"":e,t);class L{constructor(){r(this,"images",[]),r(this,"dropZone"),r(this,"fileInput"),r(this,"imageList"),r(this,"processBtn"),r(this,"progressOverlay"),r(this,"progressFill"),r(this,"progressText"),r(this,"resultsSection"),r(this,"resultsList"),this.dropZone=document.getElementById("dropZone"),this.fileInput=document.getElementById("fileInput"),this.imageList=document.getElementById("imageList"),this.processBtn=document.getElementById("processBtn"),this.progressOverlay=document.getElementById("progressOverlay"),this.progressFill=document.getElementById("progressFill"),this.progressText=document.getElementById("progressText"),this.resultsSection=document.getElementById("results"),this.resultsList=document.getElementById("resultsList"),this.initEventListeners()}initEventListeners(){var o;document.addEventListener("dragenter",i=>i.preventDefault()),document.addEventListener("dragover",i=>i.preventDefault()),document.addEventListener("dragleave",i=>i.preventDefault()),document.addEventListener("drop",i=>i.preventDefault()),this.dropZone.addEventListener("click",()=>this.fileInput.click()),this.dropZone.addEventListener("dragover",this.handleDragOver.bind(this)),this.dropZone.addEventListener("dragleave",this.handleDragLeave.bind(this)),this.dropZone.addEventListener("drop",this.handleDrop.bind(this)),this.fileInput.addEventListener("change",this.handleFileSelect.bind(this)),this.processBtn.addEventListener("click",this.processImages.bind(this)),document.querySelectorAll('input[name="mode"]').forEach(i=>{i.addEventListener("change",this.handleModeChange.bind(this))});const e=document.getElementById("quality"),t=document.getElementById("qualityValue");e.addEventListener("input",()=>{t.textContent=`${e.value}%`}),document.getElementById("smartCrop").addEventListener("change",this.handleSmartCropChange.bind(this));const n=document.getElementById("cropPadding"),c=document.getElementById("paddingValue");n.addEventListener("input",()=>{c.textContent=`${n.value}px`});const a=document.getElementById("cropTolerance"),p=document.getElementById("toleranceValue");a.addEventListener("input",()=>{p.textContent=a.value}),document.querySelectorAll('input[name="cropMode"]').forEach(i=>{i.addEventListener("change",this.handleCropModeChange.bind(this))}),(o=document.getElementById("downloadAllBtn"))==null||o.addEventListener("click",this.downloadAll.bind(this))}handleDragOver(e){e.preventDefault(),e.stopPropagation(),this.dropZone.classList.add("drag-over")}handleDragLeave(e){e.preventDefault(),e.stopPropagation(),this.dropZone.classList.remove("drag-over")}handleDrop(e){var s;e.preventDefault(),e.stopPropagation(),this.dropZone.classList.remove("drag-over");const t=Array.from(((s=e.dataTransfer)==null?void 0:s.files)||[]);this.addFiles(t)}handleFileSelect(e){const t=e.target,s=Array.from(t.files||[]);this.addFiles(s)}addFiles(e){e.filter(s=>s.type.startsWith("image/")).forEach(s=>{const n=new FileReader;n.onload=c=>{var a;this.images.push({file:s,preview:(a=c.target)==null?void 0:a.result,prefix:""}),this.renderImageList()},n.readAsDataURL(s)})}renderImageList(){if(this.images.length===0){this.imageList.innerHTML="",this.processBtn.disabled=!0;return}this.processBtn.disabled=!1,this.imageList.innerHTML=this.images.map((e,t)=>`
      <div class="image-item" data-index="${t}">
        <img src="${e.preview}" alt="${e.file.name}">
        <div class="image-info">
          <p class="image-name">${e.file.name}</p>
          <p class="image-size">${this.formatFileSize(e.file.size)}</p>
          <input type="text" 
                 class="prefix-input" 
                 placeholder="PrÃ¤fix (optional)" 
                 data-index="${t}"
                 value="${e.prefix}">
        </div>
        <button class="remove-btn" data-index="${t}">Ã—</button>
      </div>
    `).join(""),this.imageList.querySelectorAll(".prefix-input").forEach(e=>{e.addEventListener("input",t=>{const s=t.target,n=parseInt(s.dataset.index);this.images[n].prefix=s.value})}),this.imageList.querySelectorAll(".remove-btn").forEach(e=>{e.addEventListener("click",t=>{const s=t.target,n=parseInt(s.dataset.index);this.images.splice(n,1),this.renderImageList()})})}handleModeChange(){const e=document.querySelector('input[name="mode"]:checked').value,t=document.getElementById("sizeOptions");e==="resize"||e==="split-resize"?t.style.display="block":t.style.display="none"}handleSmartCropChange(){const e=document.getElementById("smartCrop"),t=document.getElementById("cropOptions");e.checked?t.style.display="block":t.style.display="none"}handleCropModeChange(){const e=document.querySelector('input[name="cropMode"]:checked').value,t=document.getElementById("uniformCropSettings"),s=document.getElementById("individualCropSettings");e==="individual"?(t.style.display="none",s.style.display="block"):(t.style.display="block",s.style.display="none")}async processImages(){if(this.images.length===0)return;const e=document.querySelector('input[name="mode"]:checked').value,t=parseInt(document.getElementById("quality").value),s=parseInt(document.getElementById("width").value)||512,n=parseInt(document.getElementById("height").value)||512,c=document.getElementById("globalPrefix").value||"image",a=document.getElementById("smartCrop").checked,p=document.querySelector('input[name="cropMode"]:checked').value;let o,i,m,u,g;p==="individual"?(i=parseInt(document.getElementById("cropPaddingTop").value)||20,m=parseInt(document.getElementById("cropPaddingRight").value)||20,u=parseInt(document.getElementById("cropPaddingBottom").value)||20,g=parseInt(document.getElementById("cropPaddingLeft").value)||20):o=parseInt(document.getElementById("cropPadding").value)||20;const f=parseInt(document.getElementById("cropTolerance").value)||10,h=new FormData,v=[];this.images.forEach((d,y)=>{h.append("images",d.file),v.push({mode:e,quality:t,width:s,height:n,prefix:d.prefix||c,smartCrop:a,cropPadding:o,cropPaddingTop:i,cropPaddingRight:m,cropPaddingBottom:u,cropPaddingLeft:g,cropTolerance:f})}),h.append("options",JSON.stringify(v)),this.showProgress();try{const d=await fetch("/api/process",{method:"POST",body:h});if(!d.ok)throw new Error("Fehler bei der Verarbeitung");const y=await d.json();this.showResults(y.results)}catch(d){console.error("Fehler:",d),alert("Fehler bei der Bildverarbeitung")}finally{this.hideProgress()}}showProgress(){this.progressOverlay.style.display="flex",this.animateProgress()}animateProgress(){let e=0;const t=setInterval(()=>{e+=Math.random()*15,e>90&&(clearInterval(t),e=90),this.progressFill.style.width=`${e}%`,this.progressText.textContent=`${Math.round(e)}%`},200)}hideProgress(){this.progressFill.style.width="100%",this.progressText.textContent="100%",setTimeout(()=>{this.progressOverlay.style.display="none",this.progressFill.style.width="0%"},500)}showResults(e){this.resultsSection.style.display="block",this.resultsList.innerHTML=e.map(t=>`
      <div class="result-item">
        <h3>${t.original}</h3>
        <p class="size-info">
          Original: ${this.formatFileSize(t.originalSize)} â†’ 
          Komprimiert: ${this.formatFileSize(t.processed.reduce((s,n)=>s+n.size,0))}
          <span class="savings">
            (${this.calculateSavings(t.originalSize,t.processed.reduce((s,n)=>s+n.size,0))}% gespart)
          </span>
        </p>
        <div class="processed-files">
          ${t.processed.map(s=>`
            <div class="processed-file">
              <span class="file-name">${s.filename}</span>
              <span class="file-size">${this.formatFileSize(s.size)}</span>
              <a href="${s.url}" download="${s.filename}" class="download-btn">
                ðŸ“¥ Download
              </a>
            </div>
          `).join("")}
        </div>
      </div>
    `).join(""),this.resultsSection.scrollIntoView({behavior:"smooth"})}async downloadAll(){const e=this.resultsList.querySelectorAll(".download-btn");for(const t of Array.from(e)){const s=t.href,n=t.download,a=await(await fetch(s)).blob(),p=URL.createObjectURL(a),o=document.createElement("a");o.href=p,o.download=n,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(p),await new Promise(i=>setTimeout(i,100))}}formatFileSize(e){if(e===0)return"0 Bytes";const t=1024,s=["Bytes","KB","MB","GB"],n=Math.floor(Math.log(e)/Math.log(t));return Math.round(e/Math.pow(t,n)*100)/100+" "+s[n]}calculateSavings(e,t){const s=(e-t)/e*100;return Math.round(s)}}document.addEventListener("DOMContentLoaded",()=>{new L});
